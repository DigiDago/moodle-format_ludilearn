/*! format_ludilearn 2024-11-28 */
define(["core_courseformat/local/courseeditor/dndcmitem","core_courseformat/courseeditor","core/templates","core/str"],function(e,i,a,t){class GamifyCm extends e{create(){this.name="format_ludilearn_cm",this.selectors={CM:'[data-for="cm"]',GAMIFY:'[data-action="cmGamify"]',NOTGAMIFY:'[data-action="cmNotgamify"]',ACTIONTEXT:".menu-action-text",ICON:".icon"},this.classes={HIDE:"d-none"},this.formatActions={GAMIFY:"cmGamify",NOTGAMIFY:"cmNotgamify"},this.icons={ICON_GAMIFIED:"i/checkedcircle",ICON_NOTGAMIFIED:"i/uncheckedcircle"},this.id=this.element.dataset.id}getWatchers(){return[{watch:`cm[${this.id}]:updated`,handler:this._refreshGamify}]}async _refreshGamify({element:e}){let t,i;i=!0===e.gamified?(t=this.formatActions.NOTGAMIFY,this.icons.ICON_NOTGAMIFIED):(t=this.formatActions.GAMIFY,this.icons.ICON_GAMIFIED),this.element.dataset.action=t;var s,e=this.element.querySelector(this.selectors.ACTIONTEXT),e=(this.element.dataset.swapname&&e&&(s=e.innerText,e.innerText=this.element.dataset.swapname,this.element.dataset.swapname=s),this.element.querySelector(this.selectors.ICON));this.element.dataset.swapicon&&e&&((s=this.element.dataset.swapicon)&&(s=await a.renderPix(s,"core"),a.replaceNode(e,s,"")),this.element.dataset.swapicon=i)}}return{init:function(){const t=i.getCurrentCourseEditor();t.supportComponents&&t.isEditing&&document.getElementsByClassName("editing_gamify").forEach(e=>{new GamifyCm({element:e,reactive:t})})}}});