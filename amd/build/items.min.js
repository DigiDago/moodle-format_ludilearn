/*! format_ludilearn 2025-03-26 */
define(["jquery","core/ajax","core/templates","core/str","core/modal_factory","core/modal_events","core/notification"],(o,e,a,r,i,s,n)=>{let l=0,c,d=[],m="",u=(t,a)=>{e.call([{methodname:"format_ludilearn_set_item_equiped",args:{courseid:l,slot:t,theme:a}}],!0,!0)[0].done(e=>{e.success&&(v(t,a),e=o(".avatar-slot.slot-"+t),0!==a?(e.attr("src",m+"image-0"+t+"-"+a+".svg"),e.addClass("item-equiped")):(e.attr("src",m+"item_icon_default.svg"),e.removeClass("item-equiped")))}).fail(n.exception)},v=(a,r)=>{d.forEach((e,t)=>{e.theme===a&&d[t].items.forEach((e,t)=>{e.theme===r?d[t].items[t].equiped=!0:d[t].items[t].equiped=!1})})},h=()=>{e.call([{methodname:"format_ludilearn_get_inventory",args:{courseid:l,sectionid:c}}],!0,!0)[0].done(e=>{d=e.inventory,o(".avatar-bag-close").on("click",()=>{o(".avatar-bag-close").hide(),o(".avatar-bag-open").attr("style","display: block;"),t()})}).fail(n.exception)},t=async()=>{var e=await a.render("format_ludilearn/avatar/items",{inventory:d});let t=await i.create({title:r.get_string("inventory","format_ludilearn"),body:e,footer:""});t.show();e=await t.getRoot();e.on(s.shown,()=>{y(1),g()}),e.on(s.hidden,()=>{t.destroy(),o(".avatar-bag-close").show(),o(".avatar-bag-open").hide()})},g=()=>{o(".avatar-item-owned").on("click",e=>{let t=o(e.currentTarget).data("slot"),a=o(e.currentTarget).data("theme"),r=o(".equip-button");o(".avatar-item-owned").removeClass("selected"),r.hide(),o(e.currentTarget).addClass("selected"),o(e.currentTarget).hasClass("avatar-item-equiped")||o(e.currentTarget).find(".equip-button").show(),r.on("click").on("click",function(){u(t,a),o(".avatar-item-equiped").removeClass("avatar-item-equiped"),o(e.currentTarget).addClass("avatar-item-equiped"),r.hide()})})},y=e=>{let t=o(".tab-inventory");null!==e&&(o(".tab-content-inventory").hide(),o("#tab-content-slot-"+e).show(),t.removeClass("active").attr("aria-selected","false"),o("#tab-slot-"+e).addClass("active").attr("aria-selected","true")),t.on("click keydown",function(e){"click"!==e.type&&("keydown"!==e.type||"Enter"!==e.key&&" "!==e.key)||(e=o(this).data("tab"),o(".tab-content-inventory").hide(),o("#tab-content-slot-"+e).show(),t.removeClass("active").attr("aria-selected","false"),o("#tab-slot-"+e).addClass("active").attr("aria-selected","true"))})};return{init:(e,t,a)=>{l=e,c=t,m=a,h()}}});