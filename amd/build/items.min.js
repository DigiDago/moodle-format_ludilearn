/*! format_ludilearn 2024-11-28 */
define(["jquery","core/ajax","core/templates","core/str","core/modal_factory","core/modal_events"],(i,e,a,o,r,s)=>{let n=0,l,d=[],c="",m=(t,r)=>{e.call([{methodname:"format_ludilearn_set_item_equiped",args:{courseid:n,slot:t,theme:r}}],!0,!0)[0].done(e=>{var a,o;e.success&&(a=t,o=r,d.forEach((e,t)=>{e.theme===a&&d[t].items.forEach((e,t)=>{e.theme===o?d[t].items[t].equiped=!0:d[t].items[t].equiped=!1})}),e=i(".avatar-slot.slot-"+t),0!==r?(e.attr("src",c+"image-0"+t+"-"+r+".svg"),e.addClass("item-equiped")):(e.attr("src",c+"item_icon_default.svg"),e.removeClass("item-equiped")))}).fail(e=>{console.error(e)})},v=()=>{e.call([{methodname:"format_ludilearn_get_inventory",args:{courseid:n,sectionid:l}}],!0,!0)[0].done(e=>{d=e.inventory,i(".avatar-bag-close").on("click",e=>{i(".avatar-bag-close").hide(),i(".avatar-bag-open").attr("style","display: block;"),t()})}).fail(e=>{console.error(e)})},t=async()=>{var e=await a.render("format_ludilearn/avatar/items",{inventory:d});const t=await r.create({title:o.get_string("inventory","format_ludilearn"),body:e,footer:""});t.show();e=await t.getRoot();e[0];e.on(s.shown,()=>{{var e=1;let t=i(".tab-inventory");null!==e&&(i(".tab-content-inventory").hide(),i("#tab-content-slot-"+e).show(),t.removeClass("active").attr("aria-selected","false"),i("#tab-slot-"+e).addClass("active").attr("aria-selected","true")),t.on("click keydown",function(e){"click"!==e.type&&("keydown"!==e.type||"Enter"!==e.key&&" "!==e.key)||(e=i(this).data("tab"),i(".tab-content-inventory").hide(),i("#tab-content-slot-"+e).show(),t.removeClass("active").attr("aria-selected","false"),i("#tab-slot-"+e).addClass("active").attr("aria-selected","true"))})}i(".avatar-item-owned").on("click",e=>{let t=i(e.currentTarget).data("slot"),a=i(e.currentTarget).data("theme"),o=i(".equip-button");i(".avatar-item-owned").removeClass("selected"),o.hide(),i(e.currentTarget).addClass("selected"),i(e.currentTarget).hasClass("avatar-item-equiped")||i(e.currentTarget).find(".equip-button").show(),o.on("click").on("click",function(){m(t,a),i(".avatar-item-equiped").removeClass("avatar-item-equiped"),i(e.currentTarget).addClass("avatar-item-equiped"),o.hide()})})}),e.on(s.hidden,()=>{t.destroy(),i(".avatar-bag-close").show(),i(".avatar-bag-open").hide()})};return{init:(e,t,a)=>{n=e,l=t,c=a,v()}}});